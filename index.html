<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>door-o-game</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (to compile JSX in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #1c1917;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #44403c;
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #57534e;
        }

        /* Animations */
        @keyframes doorOpenSequence {
          0% { transform: scale(1); opacity: 1; }
          15% { transform: scale(1.1); opacity: 1; }
          60% { transform: scale(1.1); opacity: 0.9; }
          100% { transform: scale(0); opacity: 0; }
        }
        
        .animate-door-open {
          animation: doorOpenSequence 600ms forwards ease-in-out;
        }
    </style>
</head>
<body class="bg-stone-900 text-stone-100 h-screen overflow-hidden selection:bg-amber-500 selection:text-black">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- Icons (Inline SVGs to remove dependencies) ---
        const Sparkles = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M7 3v4"/><path d="M3 7h4"/><path d="M3 5h4"/></svg>
        );
        const Skull = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>
        );
        const HelpCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
        );
        const XCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
        );
        const RotateCcw = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        );

        // --- Game Constants & Config ---
        const DOOR_TYPES = {
            STANDARD: { id: 'standard', label: 'Standard', color: 'bg-amber-700', border: 'border-amber-900', icon: null, spawnRate: 2, score: 10, chance: 0.6 },
            GOLDEN: { id: 'golden', label: 'Golden', color: 'bg-yellow-500', border: 'border-yellow-700', icon: Sparkles, spawnRate: 3, score: 50, chance: 0.1 },
            TRAP: { id: 'trap', label: 'Trap', color: 'bg-stone-800', border: 'border-red-900', icon: Skull, spawnRate: 0, score: -20, chance: 0.15 },
            MYSTERY: { id: 'mystery', label: 'Mystery', color: 'bg-purple-700', border: 'border-purple-900', icon: HelpCircle, spawnRate: 'random', score: 25, chance: 0.15 },
        };

        const DOOR_STATUS = {
            CLOSED: 'closed',
            OPENING: 'opening',
        };

        const ANIMATION_DURATION = 600; // ms

        // --- Helper Functions ---
        const generateUniqueId = () => `door-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

        const getRandomDoorType = () => {
            const entries = Object.values(DOOR_TYPES);
            const totalChance = entries.reduce((sum, d) => sum + d.chance, 0);
            let roll = Math.random() * totalChance;
            for (const def of entries) {
                roll -= def.chance;
                if (roll <= 0) return def;
            }
            return entries[0];
        };

        const resolveDoorOutcome = (doorDef) => {
            switch (doorDef.id) {
                case 'standard':
                    return { newDoorsCount: 2, points: 10, message: "The path branches..." };
                case 'golden':
                    return { newDoorsCount: 3, points: 50, message: "A treasure room! The path widens significantly." };
                case 'trap':
                    return { newDoorsCount: 0, points: -20, message: "A dead end! The door slams shut." };
                case 'mystery': {
                    const n = Math.floor(Math.random() * 4);
                    return {
                        newDoorsCount: n,
                        points: n === 0 ? 0 : 25,
                        message: n === 0 ? "It was a fake door. Nothing is here." : `Chaos! ${n} new portals appear.`
                    };
                }
                default:
                    return { newDoorsCount: 0, points: 0, message: "" };
            }
        };

        // --- Sub-Component: The Door ---
        const Door = React.memo(({ door, index, onClick, disabled }) => {
            const [isHovered, setIsHovered] = useState(false);
            const isOpening = door.status === DOOR_STATUS.OPENING;

            const handleInteraction = () => {
                if (disabled || door.status !== DOOR_STATUS.CLOSED) return;
                onClick(door);
            };

            const TypeIcon = door.def.icon;
            const baseClasses = "relative w-32 h-48 rounded-t-full shadow-xl transition-all duration-300 cursor-pointer select-none transform";
            const hoverClasses = !disabled && door.status === DOOR_STATUS.CLOSED && isHovered ? "scale-105 -translate-y-2 shadow-2xl z-10" : "";
            const disabledClasses = disabled && !isOpening ? "opacity-60 cursor-not-allowed" : "";
            const animationClasses = isOpening ? "animate-door-open" : "";
            const frameStyle = `border-4 ${door.def.border} ${door.def.color}`;
            const innerStyle = isOpening ? 'bg-white' : 'bg-black';

            return (
                <div 
                    className={`${baseClasses} ${hoverClasses} ${disabledClasses} ${animationClasses}`}
                    onClick={handleInteraction}
                    onMouseEnter={() => setIsHovered(true)}
                    onMouseLeave={() => setIsHovered(false)}
                >
                    <div className={`absolute inset-0 ${frameStyle} ${innerStyle} rounded-t-full overflow-hidden flex flex-col items-center justify-center`}>
                        {door.status === DOOR_STATUS.CLOSED && (
                            <div className={`absolute inset-1 ${door.def.color} rounded-t-full border-2 border-white/10 flex items-center justify-center shadow-inner`}>
                                <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')]"></div>
                                <div className="absolute right-4 top-1/2 w-3 h-3 bg-yellow-400 rounded-full shadow-md border border-yellow-600 group-hover:bg-yellow-200 transition-colors"></div>
                                {TypeIcon && <TypeIcon className="w-8 h-8 text-white/50" />}
                                {!TypeIcon && <div className="text-4xl font-serif text-black/20 font-bold">{index + 1}</div>}
                            </div>
                        )}
                        {isOpening && (
                            <div className="absolute inset-0 bg-white flex items-center justify-center">
                                <span className="text-black font-bold text-lg animate-pulse">
                                    {door.def.id === 'trap' ? 'TRAP!' : 'OPEN!'}
                                </span>
                            </div>
                        )}
                    </div>
                </div>
            );
        });

        // --- Main Application Component ---
        function App() {
            const [doors, setDoors] = useState([]);
            const [score, setScore] = useState(0);
            const [doorsOpenedCount, setDoorsOpenedCount] = useState(0);
            const [gameStatus, setGameStatus] = useState('init'); // init, playing, gameover
            const [logs, setLogs] = useState(["You stand before 3 doors. Choose wisely."]);
            const [isProcessing, setIsProcessing] = useState(false);
            
            const logContainerRef = useRef(null);
            
            // Auto-scroll logs
            useEffect(() => {
                if (logContainerRef.current) {
                    logContainerRef.current.scrollTop = logContainerRef.current.scrollHeight;
                }
            }, [logs]);

            // Game Over Check
            useEffect(() => {
                if (gameStatus === 'playing' && doors.length === 0 && !isProcessing) {
                    setGameStatus('gameover');
                    setLogs(prev => [...prev.slice(-5), "The lights go out. There are no more doors."]);
                }
            }, [doors, gameStatus, isProcessing]);

            // Initial Start
            useEffect(() => {
                startGame();
            }, []);

            const addLog = (msg) => {
                setLogs(prev => [...prev.slice(-5), msg]);
            };

            const startGame = () => {
                const initialDoors = Array.from({ length: 3 }).map(() => ({
                    id: generateUniqueId(),
                    def: DOOR_TYPES.STANDARD,
                    status: DOOR_STATUS.CLOSED,
                }));
                setDoors(initialDoors);
                setScore(0);
                setDoorsOpenedCount(0);
                setGameStatus('playing');
                setLogs(["A new hallway stretches before you..."]);
                setIsProcessing(false);
            };

            const handleDoorClick = useCallback((door) => {
                if (isProcessing || gameStatus !== 'playing') return;

                // 1. Lock UI
                setIsProcessing(true);

                // 2. Start Animation (Update Status)
                setDoors(current => current.map(d => 
                    d.id === door.id ? { ...d, status: DOOR_STATUS.OPENING } : d
                ));

                // 3. Process Logic after delay
                setTimeout(() => {
                    const { newDoorsCount, points, message } = resolveDoorOutcome(door.def);

                    setScore(s => s + points);
                    setDoorsOpenedCount(c => c + 1);
                    addLog(message);

                    setDoors(current => {
                        const remaining = current.filter(d => d.id !== door.id);
                        const newDoors = Array.from({ length: newDoorsCount }).map(() => ({
                            id: generateUniqueId(),
                            def: getRandomDoorType(),
                            status: DOOR_STATUS.CLOSED,
                        }));
                        return [...remaining, ...newDoors];
                    });

                    setIsProcessing(false);
                }, ANIMATION_DURATION);
            }, [isProcessing, gameStatus]);

            return (
                <div className="flex flex-col h-full">
                    {/* HEADER: HUD */}
                    <div className="bg-stone-950 border-b border-stone-800 p-4 shadow-lg z-20">
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold tracking-widest text-amber-500 uppercase">door-o-game</h1>
                            </div>
                            
                            <div className="flex gap-8 text-center">
                                <div>
                                    <div className="text-xs text-stone-500 uppercase tracking-wider">Score</div>
                                    <div className="text-2xl font-mono text-white">{score}</div>
                                </div>
                                <div>
                                    <div className="text-xs text-stone-500 uppercase tracking-wider">Opened</div>
                                    <div className="text-2xl font-mono text-amber-200">{doorsOpenedCount}</div>
                                </div>
                                <div>
                                    <div className="text-xs text-stone-500 uppercase tracking-wider">Available</div>
                                    <div className="text-2xl font-mono text-stone-300">{doors.length}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* MAIN GAME AREA */}
                    <div className="flex-1 overflow-y-auto p-8 relative custom-scrollbar">
                        <div className="absolute inset-0 flex items-center justify-center pointer-events-none opacity-5">
                            <span className="text-9xl font-black">CHOOSE</span>
                        </div>

                        <div className="max-w-6xl mx-auto min-h-[50vh]">
                            {gameStatus === 'playing' || gameStatus === 'init' ? (
                                <div className="flex flex-wrap gap-8 justify-center items-center content-center transition-all duration-500">
                                    {doors.map((door, index) => (
                                        <Door 
                                            key={door.id} 
                                            door={door} 
                                            index={index}
                                            onClick={handleDoorClick}
                                            disabled={isProcessing}
                                        />
                                    ))}
                                    {doors.length === 0 && gameStatus === 'playing' && (
                                        <div className="text-stone-500 italic">The hallway is empty...</div>
                                    )}
                                </div>
                            ) : (
                                <div className="flex flex-col items-center justify-center h-full animate-in fade-in zoom-in duration-500 mt-20">
                                    <XCircle className="w-24 h-24 text-stone-700 mb-6" />
                                    <h2 className="text-4xl font-bold text-stone-300 mb-2">Dead End</h2>
                                    <p className="text-stone-500 mb-8">You opened {doorsOpenedCount} doors and scored {score} points.</p>
                                    <button 
                                        onClick={startGame}
                                        className="flex items-center gap-2 px-8 py-3 bg-amber-700 hover:bg-amber-600 text-white rounded-full font-bold transition-all shadow-lg hover:shadow-amber-900/50"
                                    >
                                        <RotateCcw className="w-5 h-5" /> Try Again
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* FOOTER: Log & Info */}
                    <div className="bg-stone-950 border-t border-stone-800 p-4 h-32 flex-shrink-0 z-20">
                        <div className="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-4 h-full">
                            
                            {/* Action Log */}
                            <div className="relative h-full overflow-hidden border-l-2 border-stone-800 pl-4">
                                <div className="absolute top-0 left-4 text-[10px] text-stone-600 uppercase tracking-widest mb-1">Journal</div>
                                <div ref={logContainerRef} className="h-full overflow-y-auto pt-5 space-y-1 text-sm font-mono text-stone-400">
                                    {logs.map((log, i) => (
                                        <div key={i} className="animate-in slide-in-from-left-2 duration-300">
                                            <span className="text-stone-600 mr-2">{'>'}</span>{log}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Legend */}
                            <div className="hidden md:flex items-center justify-end gap-6 text-xs text-stone-500">
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 bg-amber-700 rounded-sm"></div> Standard (+2 Doors)
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 bg-yellow-500 rounded-sm"></div> Golden (+3 Doors)
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 bg-purple-700 rounded-sm"></div> Mystery (?)
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 bg-stone-800 border border-red-900 rounded-sm"></div> Trap (Dead End)
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
